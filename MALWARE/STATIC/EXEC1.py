import sys
import r2pipe
import os
import pydot
os.environ["PATH"] += os.pathsep + 'C:/Program Files (x86)/Graphviz2.38/bin/'
#import radare
class Radare:
    def graph(filepath):

        #log.info('Static Analysis started.')

        # start radare2
        r2 = r2pipe.open(filepath, ['-2'])
        r2.cmd('aaa')
        #self._r2.cmd('agfd')
        basicblock = r2.cmd("agfd")
        #print(r2.cmd('agfd'))
        # binary info
        #self._r2_info()

        # strings
        #self._load_strings()

        r2.quit()
        #log.info('Static Analysis finished.')

        return basicblock

files = []
for dir_name, sub_dir_list, file_list in os.walk(sys.argv[1]):
    for file_name in file_list:
        file_path = os.path.join(dir_name, file_name)
        files.append(file_path)
x = 0
for f in files:
    x = x+1
    if(x>800):break
    r = Radare.graph(f)
#print(r)
    var = f.split('/')
    #var = var[6].split('.')
    file2 = open("/home/diya/radare2/outputben/"+var[6]+".txt", "w+") 
    file2.write(r)
    file2.close()


